# Реакция на вирус-вымогатель
мастер-плейбук для случаев вымогателей. Этот playbook является ручным playbook.

## Вовлечение

+ Уведомить сеть управления. Уведомить соответствующих людей внутри организации.
+ Убедитесь, что в инциденте есть соответствующая информация: имя системы, имя конечного пользователя и начальная серьезность в соответствии с отчетом.
+ Оценить серьезность. На основе затронутого конечного пользователя, а также другая информация оценивать и измените серьезность, если это необходимо.
+ Назначить и привлечь соответствующий персонал. Пригласите соответствующих пользователей для расследования - эксперт по вредоносным программам и сетевые эксперты, если это необходимо.

## Расследование

+ Шаг расследования: подробности этого инцидента
+ уведомить ИТ-отдел о деталях конечного пользователя для замены устройства
      1. Сообщите ИТ-отделу данные конечного пользователя о замене устройства.
      2. Надеемся есть данные для восстановления данных конечного пользователя
 
+ Cообщается ли об инциденте конечным пользователем или предупреждением от SIEM (или другого
        продукт безопасности)?
     * Оповещение от продукта безопасности:
            инцидент реален или ложно-положительный?
            1. Если URL-адрес был помечен в журналах прокси-серверов или IDS или SIEM, проверьте, почему: проверьте URL-адрес и репутацию IP-адресов по каналам угроз.
            2. Если уведомление пришло из файла, проверьте (почтасервер или веб-сервер) - проверять репутацию файла (хэш) по отношению к каналам угроз, таким как Virustotal
            
            Ложно положительный: ометить инцидент как ложноположительный в SIEM, закрыть проблему в системе управления инцидентами
            Реальный инцидент:
                  + определите затронутую конечную точку и пользователя:
                        1. Получите исходный IP-адрес из оповещения и добавьте его в расследование.
                        2. Получить пользователя, связанного с этой системой, с контроллера домена и AD
                  + Позвоните пользователю и сообщите ему детали инцидента.
                  + Попросите пользователя отключить систему от сети - включите Wi-Fi выкл, если нужно.
      * Пользователь сообщил об инциденте:
         + документ, подтверждающий детали пользователя в расследовании
              Возьмите следующие данные у конечного пользователя и зарегистрируйте их в заявке:
               1. Имя работника
               2. Контактные данные
               3. Имя компьютера
               4. IP-адрес

               Знает ли пользователь, что он / она нажал на подозрительную ссылку или вложение в последнее время?
         + собрать соответствующую информацию об инциденте
                  1. Всплыло ли окно с требованием выкупа?
                  2. Был ли текстовый файл с инструкциями размещен на рабочем столе?
                  3. Были ли расширения файлов изменены на .abc, .xxx или аналогичные?
                  4. Файлы недоступны?
                  5. Знает ли пользователь, что он / она нажал на подозрительную ссылку или вложение в последнее время?
          + выполнить начальную локализацию. попросите пользователя отключить устройство от сети. Если
        пользователь подключается к сети с помощью Wi-Fi, он должен отключить его.
   
 ## Расследование

Определить источник инфекции
__Вариант 1__: выяснить, было ли вымогатель доставлено по электронной почте
      анализируйте журналы электронной почты, чтобы сузить подозрительные электронные письма 
            1. Перейдите в SIEM
            2. Фильтруйте журналы электронной почты, связанные с пользователь за последние 3 дня
            3. Снова отфильтруйте письма, на которых был получатель жертва
            4. Удалите журналы электронной почты, в которых находился отправитель из вашей компании.
            5. Экспортируйте список писем в файл CSV. Он должен содержать только электронные письма отправлено пострадавшему из Интернета в течение последних 3 дней.
            
       собирать и анализировать подозрительные электронные письма
            1. Отправьте CSV-файл в IT-команду и попросите их получить полную версию. электронные письма из почтового ящика пользователя. Приложите резюме к расследованию в качестве доказательства.
            2. Как только вы получите электронные письма в zip-файле, просмотрите их, чтобы выявить подозрительные
        ссылки или вложения.
            3. Ищите ссылки, которые не указывают на один и тот же URL отображается на экране (например, <a href=agedhttp://malware.com двуспальная> http://www.bbc.co.uk </a>)
            4. Убедитесь, что домен в поле «От:» соответствует теме электронного письма. (например, электронные письма с уведомлением о доставке посылки от UPS не будут приходить от john@mypersonalblog.com)
            5. При необходимости сканируйте подозрительные URL-адреса с помощью каналов угроз, таких как Virustotal, http://www.phishtank.com.
            Если вы обнаружите подозрительный URL, проанализируйте его подробно в следующих шагах.
      
      анализ подозрительных URL-адресов и файлов, собранных из электронных писем (вредоносная программа)
      
            1. Если вы обнаружили подозрительный URL, скачайте вредоносный файл с "curl"
            2. Проверьте репутацию файла, используя virustotal и другие угрозы каналы.
            3. Провести статический и динамический анализ файлов с помощью песочницы или SIFT рабочая станция.
            4. Если вы обнаружили подозрительный файл, загрузите его в VT или другой AV продавцы
          
 
 __Вариант 2__: выяснить, не был ли компьютер жертвы заражен Эксплойт / Драйв-Драйв скачать
      
      анализ журналов веб-прокси (или веб-шлюза), чтобы найти подозрительный URД
            1. Перейти в SIEM
            2. Фильтр логов прокси за последние 3 дня
            3. Фильтруйте имя пользователя затронутого пользователя (все пользователи должны проходить проверку подлинности на прокси-сервере).
            4. Отфильтруйте URL-адреса, которые были классифицированы, в вашем списке должны быть только некатегоризованные URL-адреса.
            5. Экспорт списка в CSV
            6. Сортировка списка по URL, удаление дубликатов
            7. Убедитесь, что это связано с расследованием
      
      анализ URL-адресов из предыдущей задачи на наличие вредоносных URL
            1. Проверьте репутацию всех собранных URL-адресов на фиды угроз, такие как virustotal.
            2. Поиск подозрительных URL-адресов, таких как:
                  IP-адрес в URL
                  Случайные символы в имени хоста URL (например, http://asdheguhadaasd.com)
                  URL содержит много случайных букв и / или цифр
                  Участвуют сайты WordPress (wp-контент…)
             3. Поиск запросов к Tor2Web (например, https://3fdzgtam4qk625n6.fi/)
             4. Странные строки User-Agent, такие как IE6 (например, Mozilla / 5.0 (совместимый; MSIE 6.0; Windows NT 5.1))
             Программные библиотеки (например, python-запросы / 1.2.0)б dJava (например, Java / 1.6.0_13)
      
      проанализируйте URL в песочнице. Рассмотрим более глубокий анализ URL с помощью песочницы типа Cuckoo. На основе анализа здесь и предыдущего шага создайте окончательный список вредоносного URL.
      
      получить информацию о файле из веб-журналов для загруженных файлов
            1. Получите хеш для скачанных файлов.
            2. Проверьте репутацию файлов против угроз.
            
      
## Реагирование     
Генерация IoC из URL и хэшей. Возьмите вредоносный URL и файлы из этого раздела и сгенерируйте IOC, используя шаги из Раздела: Генерация IoC из URL и хэшей
     + создание IoC для URL и хэшей
           + генерировать IOC для вредоносного URL из SIEM Threat Feed
                  1. Получите список помеченных URL / хэшей из Расследования Шаг
                  2. Проверьте URL-адрес на фид угроз (virustotal, IBM Xforce).
                  3. Проверьте Ваш SIEM для каналов угроз и посмотрите, есть ли IOC, связанные с URL.
                  4. Подписывайтесь на канал в SIEM. Это установит соответствующие IoC в наши SIEM автоматически.
                  5. Если ни один из IoC не указан в ленте TI, необходимо генерировать IoC вручную на следующем шаге
            + генерировать IOC для вредоносного URL вручную
                  1. Зайдите в логи прокси снова
                  2. Найдите 2-3 связанных свойства с помеченным URL, например:
                        * Запрос POST User-Agent поле хитрое (Java, Python, IE6 и т. д.)
                        * URL содержит более 128 случайных  символы
                        * URL содержит .php URL содержит много косых черт (/)  URL содержит вещи, связанные с WordPress (wp-content)
                        * URL содержит хитрые TLD (например, .tk, .ru)
                  3. Проверьте свои предположения на прокси журналы в SIEM. Используйте свой шаблон и проверьте, сколько ложных срабатываний и
              истинные позитивы это производит.
                  4. Если шаблон достаточно хорош, добавьте результаты расследования.
             + генерировать МОК из фишинговых писем. Если вы обнаружили в предыдущих шагах, что источником был фишинг электронной почты:
                  1. Найдите все URL-адреса в электронном письме и выполните генерацию URL-адреса IOC шаги.
                  2. Найдите все вложения для электронной почты и проанализируйте файл, используя этапы создания файла IOC.
                  3. Если эти шаги идентифицируют файлы или URL как вредоносные извлекать отправителя, отправляющий домен и другие свойства для поиска писем.
                  используйте эти данные, чтобы заблокировать будущие электронные письма.
      + развернуть собранные IoC
            1. Разверните новое правило в SIEM, это предупредит о новых попытках заражения в будущем.
            2. Пометьте хэши, собранные как вредоносные в SIEM, и импортируйте их в базы данных IOC для своего предприятия.
            2. Отправьте шаблоны в ИТ-отдел и попросите ИТ-отдел заблокировать эти URL-адреса на прокси-сервере и веб-шлюзе.
       + Определить другие уязвимые устройства
       + определить другие системы на основе URL и хэшей
            1. Перейдите в SIEM и найдите шаблон URL в Генерации IOC. войдите в журналы прокси, чтобы идентифицировать другие компьютеры, которые уже затронуты.
            2. Поиск хэшей, идентифицированных во всех журналах, и определение систем, связанных с ними. Если вы определили другие затронутые ПК с помощью вышеупомянутых двух шагов, создайте новый инцидент.
        + Cоздать новый инцидент с уязвимыми системами.Создание новых инцидентов на основе вышеуказанных шагов.
  
## Реагирование
+уведомить пострадавшего пользователя. Уведомить пострадавшего пользователя о результатах расследования.
+ проверка развертывания МОК. Убедитесь, что развертывание IOC на месте. Это МОК определены из предыдущих шагов.
+ удалить временные меры сдерживания. удалить временные меры сдерживания, которые были помещены.
+ предоставить руководство по исправлению для конечного пользователя и ссылку на обучение
+ Известно ли идентифицированное вредоносное ПО? (с автоматизированными этапами восстановления)
      * Да:  триггерные сценарии исправления
      * Нет: шаги по исправлению документа вручную
+ Восстановление прошло успешно?
      * Нет: перезаписать всю систему и восстановить из резервной копии
