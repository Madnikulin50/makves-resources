# Реагирование на Malware

Мастер-сценарий для расследования предполагаемого наличия вредоносных программ на конечной точке.

## Подготовка
+ Получить профиль устройства из программного обеспечения для управления ИТ-активами.
+ Получить информацию о сотруднике владельца машины из программного обеспечения HR
+ Просмотр сведений об инциденте  Понять начальный контекст исследования. Если какие-либо данные отсутствуют, соберите их.
    * имя системы
    * вовлеченные люди
    * имена пользователей участвуют
    * начальная важность как сообщалось
    * начальные известные события и время возникновения
+ На основе затронутого конечного пользователя, а также другой информация оцените и
        измените важность, если это необходимо.
        
+ Уведомить руководителя IR команды через Slack и Email. Сообщите, что мы расследуем подозрительную рабочую станцию
+ Назначить и привлечь соответствующий персонал. Пригласите соответствующих пользователей для расследования - эксперт по вредоносным программам и
        сетевые эксперты, если это необходимо.

## Обнаружение        
Просмотр данных мониторинга
+ Доступен ли Carbon black? Запросите Carbon Black о событиях во время инцидента
+ ProtectWise доступен? Получить наблюдения, связанные с исследуемой машиной.
+ Splunk доступен? Search Splunk для последних событий, связанных с исследуемым компьютером.
+ Есть ли непрерывный захват сетевого трафика исследуемой машины? Получите дамп трафика за последние 24 часа или не более 200 МБ
+ Просмотр журналов антивируса для уязвимых систем
+ Поиск решения UEBA для соответствующего поведения пользователя за последние 24 часа
+ Искать в журналах DNS-сервера информацию об активности компьютера
+ Искать в журналах веб-прокси последние действия с этого компьютера
+ Поиск журналов брандмауэра для заблокированного трафика с этого компьютера
+ Собрать улики у исследуемой машины
+ Tanium доступен? Собирать системную информацию используя Tanium
+ Вызвать моментальный снимок/точку восстановления системы уязвимых систем. создание полной резервной копии уязвимых систем для восстановления и криминалистики.
+ собирать изменчивые системные данные. Сбор системных данных, таких как запущенные процессы, сетевые подключения и файлы изменились.
+ получить журнал событий безопасности системы
+ создать дамп памяти системы. В дополнение к полной резервной копии создать дамп памяти системы.
+ собирать данные автозапуска
+ собирать данные предварительной выборки
+ собирать историю браузера
+ собирать историю USB-устройств

## Анализ собранных доказательств

+ ищите подозрительные локальные учетные записи пользователей Windows и группы
+ ищите подозрительные записи автозапуска
+ проверить репутацию файла для всех элементов автозапуска
+ детонировать любые подозрительные элементы автозапуска в песочнице
+ Проверьте процессы по нашему арсеналу подписей YARA
+ Volatility - поиск вредоносных IP-адресов в артефактах сетевого подключения
+ Volatility - проверяет домены в кеше DNS на предмет анализа угроз
+ Volatility - Поиск подозрительных доменов в артефактах кеша DNS
+ волатильность - обзор результатов psxview
+ Volatility - обзор результатов поиска ошибок
+ Volatility - показать список ранее запущенных системных команд
+ соотнесите недавно созданные и измененные файлы с информацией об угрозах. Исследуйте текущую разведку угроз для файловой активности

### просмотр данных предварительной выборки

+ Просмотр истории подключенных USB-накопителей
+ Найдите процессы без исполняемого образа на диске
+ Поиск системных процессов с подозрительным временем выполнения
+ Поищите имена процессов с небольшим расстоянием редактирования от известных имен процессов описание: это могут быть попытки обмануть исследователя (например, scvhost.exe)
+ Проверьте дерево процессов и найдите подозрительные отношения
+ Поищите следы сетевых снифферов
+ Проведите анализ вхолящего и исходящего сетевого трафика на наличие вредоносных программ.
+ Обзор данных оболочки
+ Ищите хэши всех запущенных процессов и загруженных модулей, чтобы найти трояны
+ Анализ сетевого трафика на наличие признаков вторжения. Проанализируйте сетевой трафик от / к этой системе на наличие признаков вторжения.
+ Поищите модификации системных файлов


### Оценка утечки данных

+ Оценка истории связи C & C в сетевых журналах
+ Оценка истории локального и удаленного доступа к файлам вредоносной программой.
+ Оценка необычной активности и доступа к данным скомпрометированных учетных записей пользователей
+ Была ли утечка конфиденциальной информации? Команда по связям с общественностью (PR)

### Удаление
+ Было ли обнаружено вредоносное ПО? 
    - __Нет__: сообщить пользователю, что вредоносное ПО не найдено.
    - __Да__: сообщить об образце вредоносного ПО поставщику AV.
+ Отключить скомпрометированные учетные записи AD
+ Отменить ключи аутентификации, хранящиеся на скомпрометированном хосте
+ Отозвать учетные данные VPN
+ Поручить владельцу изменить пароли для любых личных учетных записей. Персональная электронная почта, социальные сети, профиль LinkedIn - они находятся под контролем сотрудника и должны быть задействованы для смены паролей. ИТ / безопасность персонала могут помочь ускорить. Это не только в интересах сотрудника - для организации существует реальная опасность: доступ к этим учетным записям может позволить вору убедительно выдать себя за владельца устройства, чтобы участвовать в социальной инженерии против других наших сотрудников и проводить дальнейшие атаки организация.
+ Запретить соответствующие хеши во всех системах
+ Поиск таких же вредоносных сообщений из других систем

### Восстановление
+ Уведомить пострадавшего пользователя о результатах расследования.
+ Предоставить руководство по исправлению для конечного пользователя и ссылку на обучение
+ Известно ли идентифицированное вредоносное ПО? (с автоматизированными этапами восстановления) 
    - __Нет__: шаги по исправлению документа вручную
    - __Да__: триггерные сценарии исправления
+ Восстановление прошло успешно?
    - __Нет__: откройте заявку для ИТ-специалистов, чтобы восстановить образ всей системы и восстановить данные из резервной копии.
    - __Да__:  удалить временные меры сдерживания, которые были помещены. восстановить отключенные учетные записи пользователей с новыми паролями
+ разверните сгенерированные IoC в соответствующих элементах управления, чтобы предотвратить будущие атаки

### Выводы
+ делиться созданными IoC с партнерскими организациями
+ отправить отчет по электронной почте CISO
+ выставить настроенные интеграции
