# Реагирование на Malware

Мастер Playbook для расследования подозреваемого наличия вредоносных программ на конечной точке.

Метки:
- Система: имя хоста для исследуемой конечной точки
теги:
- вирус
- вредоносное ПО

## Расследование 
### Начальная сортировка
+ Получить профиль устройства из программного обеспечения для управления ИТ-активами.
+ Получить информацию о сотруднике владельца машины из программного обеспечения HR
+ Просмотр сведений об инциденте  Понять начальный контекст исследования. Если какие-либо данные отсутствуют, соберите их.
       * имя системы
       * вовлеченные люди
       * имена пользователей участвуют
       * начальная серьезность как сообщалось
       * начальные известные события и время возникновения
+ Оценить серьезность. На основе затронутого конечного пользователя, а также другая информация оценивать и
        измените серьезность, если это необходимо.
        
+ Уведомить руководителя IR команды через Slack и Email. Сообщите, что мы расследуем подозрительную рабочую станцию
+ Назначить и привлечь соответствующий персонал. Пригласите соответствующих пользователей для расследования - эксперт по вредоносным программам и
        сетевые эксперты, если это необходимо.
        
Просмотр данных мониторинга
+ Доступен ли Carbon black? Запросите Carbon Black для событий во время инцидента
+ ProtectWise доступен? Получить наблюдения, связанные с исследуемой машиной. Извлекать события, связанные с исследуемым автоматом
+ Splunk доступен? Search Splunk для последних событий, связанных с исследуемым компьютером.
+ у нас есть непрерывный сетевой захват исследуемой машины? получение захвата пакета за последние 24 часа или не более 200 МБ
+ просмотр журналов антивируса для уязвимых систем
+ поиск решения UEBA для соответствующего поведения пользователя за последние 24 часа
+ Искать в журналах DNS-сервера информацию об активности компьютера
+ Искать в журналах веб-прокси последние действия с этого компьютера
+ Поиск журналов брандмауэра для заблокированного трафика с этого компьютера
+ Собрать улики у исследуемой машины
+ Tanium доступен? собирать системную информацию используя Tanium

+ вызвать моментальный снимок / точку восстановления системы уязвимых систем. создание полной резервной копии уязвимых систем для восстановления и криминалистики.
+ собирать изменчивые системные данные. Сбор системных данных, таких как запущенные процессы, сетевые подключения и файлы изменились.
+ получить журнал событий безопасности системы
+ создать дамп памяти системы. В дополнение к полной резервной копии создать дамп памяти системы.
+ собирать данные автозапуска
+ собирать данные предварительной выборки
+ собирать историю браузера
+ собирать историю USB-устройств

## Анализ собранных доказательств

+ ищите подозрительные локальные учетные записи пользователей Windows и группы
+ ищите подозрительные записи автозапуска
+ проверить репутацию файла для всех элементов автозапуска
+ детонировать любые подозрительные элементы автозапуска в песочнице
+ Проверьте процессы по нашему арсеналу подписей YARA
+ Volatility - поиск вредоносных IP-адресов в артефактах сетевого подключения
+ Volatility - проверяет домены в кеше DNS на предмет анализа угроз
+ Volatility - Поиск подозрительных доменов в артефактах кеша DNS
+ волатильность - обзор результатов psxview
+ Volatility - обзор результатов поиска ошибок
+ Volatility - показать список ранее запущенных системных команд
+ соотнесите недавно созданные и измененные файлы с информацией об угрозах. Исследуйте текущую разведку угроз для файловой активности

### просмотр данных предварительной выборки

+ просмотр истории подключенных USB-накопителей
+ ищите процессы без исполняемого образа на диске
+ поиск системных процессов с подозрительным временем выполнения
+ ищите имена процессов с небольшим расстоянием редактирования от известных имен процессов описание: это могут быть попытки обмануть исследователя (например, scvhost.exe)
+ проверьте дерево процессов и найдите подозрительные отношения
+ искать следы сетевых снифферов
+ анализ сетевого трафика на наличие вредоносных программ. Анализ сетевого трафика из / в эту систему на наличие вредоносных программ
+ обзор данных оболочки
+ ищите хэши всех запущенных процессов и загруженных модулей, чтобы найти трояны
+ анализ сетевого трафика на наличие признаков вторжения. Проанализируйте сетевой трафик от / к этой системе на наличие признаков вторжения.
+ ищите модификации системных файлов


### Оценка утечки данных

+ Оценка истории связи C & C в сетевых журналах
+ Оценка истории локального и удаленного доступа к файлам вредоносной программой.
+ Оценка необычной активности и доступа к данным скомпрометированных учетных записей пользователей
+ Была ли утечка конфиденциальной информации? Команда по связям с общественностью (PR)

### Реагирование
+ было ли обнаружено вредоносное ПО? Если нет, сообщить пользователю, что вредоносное ПО не найдено. Если да, сообщить об образце вредоносного ПО поставщику AV.
+ отключить скомпрометированные учетные записи AD
+ отменить ключи аутентификации, хранящиеся на скомпрометированном хосте
+ отозвать учетные данные VPN
+ поручить владельцу изменить пароли для любых личных учетных записей. Персональная электронная почта, социальные сети, профиль LinkedIn - они находятся под контролем сотрудника и должны быть задействованы для смены паролей. ИТ / безопасность персонала могут помочь ускорить. Это не только в интересах сотрудника - для организации существует реальная опасность: доступ к этим учетным записям может позволить вору убедительно выдать себя за владельца устройства, чтобы участвовать в социальной инженерии против других наших сотрудников и проводить дальнейшие атаки организация.
      
+ запретить соответствующие хеши во всех системах
+ поиск таких же вредоносных сообщений из других систем

### исправление и завершение
+ уведомить пострадавшего пользователя. Уведомить пострадавшего пользователя о результатах расследования.
+ предоставить руководство по исправлению для конечного пользователя и ссылку на обучение
+ Известно ли идентифицированное вредоносное ПО? (с автоматизированными этапами восстановления) 
       + Нет: шаги по исправлению документа вручную
       + Да: триггерные сценарии исправления
+ Восстановление прошло успешно?
       + Нет: откройте заявку для ИТ-специалистов, чтобы восстановить образ всей системы и восстановить данные из резервной копии.
       + Да:  удалить временные меры сдерживания, которые были помещены. восстановить отключенные учетные записи пользователей с новыми паролями
+ разверните сгенерированные IoC в соответствующих элементах управления, чтобы предотвратить будущие атаки
+ делиться созданными IoC с партнерскими организациями
+ отправить отчет по электронной почте CISO
+ выставить настроенные интеграции
